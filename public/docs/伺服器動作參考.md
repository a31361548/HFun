# Server Actions Reference — HealthFun Backend

> 這份文件列出前端可直接呼叫的 Server Actions（Dashboard、日誌、管理員）。

---

## TypeScript Types

```ts
export type WaterSetting = {
  _id: string;
  userId: string;
  cupSizeCc: number;
  dailyTargetCc: number;
  defaultDrinkCc: number;
  note?: string;
  createdAt: string;
  updatedAt: string;
};

export type WaterEntry = {
  _id: string;
  userId: string;
  date: string;
  amountCc: number;
  time: string;
  note?: string;
  createdAt: string;
};

export type Task = {
  _id: string;
  userId: string;
  date: string;
  title: string;
  exp: number;
  completed: boolean;
  createdAt: string;
  updatedAt: string;
};

export type LogType = "food" | "sport" | "weight" | "mood";

export type Log = {
  _id: string;
  userId: string;
  type: LogType;
  date: string;
  time: string;
  data: Record<string, unknown>;
  createdAt: string;
};

export type Member = {
  _id: string;
  username: string;
  name: string;
  avatar: string;
  role: "Admin" | "Member" | "Coach";
  status: "Active" | "Suspended";
  createdAt: string;
  updatedAt: string;
};
```

---

## Dashboard Actions

### `getWaterSetting()`
取得使用者的水分設定。若尚未建立，會建立預設值。

**Response**
```json
{
  "_id": "...",
  "userId": "...",
  "cupSizeCc": 300,
  "dailyTargetCc": 1800,
  "defaultDrinkCc": 250,
  "note": "",
  "createdAt": "2026-01-29T12:00:00.000Z",
  "updatedAt": "2026-01-29T12:00:00.000Z"
}
```

---

### `updateWaterSetting(input)`
更新水分設定。

**Input**
```json
{
  "cupSizeCc": 300,
  "dailyTargetCc": 1800,
  "defaultDrinkCc": 250,
  "note": "玻璃杯"
}
```

---

### `addWaterEntry(input)`
新增喝水紀錄。

**Input**
```json
{
  "amountCc": 250,
  "time": "08:10",
  "note": "早餐後",
  "date": "2026-01-29"
}
```

---

### `getWaterEntriesByDate(date?)`
取得指定日期的喝水紀錄，若未傳 date 則使用今日。

**Response**
```json
[
  {
    "_id": "...",
    "userId": "...",
    "date": "2026-01-29",
    "amountCc": 250,
    "time": "08:10",
    "note": "早餐後",
    "createdAt": "2026-01-29T12:00:00.000Z"
  }
]
```

---

### `getTasksByDate(date?)`
取得指定日期的任務清單。

**Response**
```json
[
  {
    "_id": "...",
    "userId": "...",
    "date": "2026-01-29",
    "title": "晨間伸展 10 分鐘",
    "exp": 50,
    "completed": false,
    "createdAt": "2026-01-29T12:00:00.000Z",
    "updatedAt": "2026-01-29T12:00:00.000Z"
  }
]
```

---

### `createTask(input)`
新增任務。

**Input**
```json
{
  "title": "晨間伸展 10 分鐘",
  "exp": 50,
  "date": "2026-01-29"
}
```

---

### `toggleTaskCompletion(taskId, completed)`
更新任務完成狀態。

**Input**
```json
{
  "taskId": "...",
  "completed": true
}
```

---

## Logs Actions

### `createLog(input)`
新增日誌記錄。

**Input**
```json
{
  "type": "food",
  "date": "2026-01-29",
  "time": "12:30",
  "data": {
    "meal": "午餐",
    "notes": "雞胸肉沙拉"
  }
}
```

**data 結構依 type 不同**
- food: `{ meal, image?, notes? }`
- sport: `{ sportType, duration, calories? }`
- weight: `{ weight }`
- mood: `{ emoji, notes? }`

**對應 TypeScript 型別**
```ts
export type FoodLogData = { meal: string; image?: string; notes?: string };
export type SportLogData = { sportType: string; duration: number; calories?: number };
export type WeightLogData = { weight: number };
export type MoodLogData = { emoji: string; notes?: string };
```


---

### `getLogsByDate(date?)`
取得指定日期的日誌清單，若未傳 date 則使用今日。

**Response**
```json
[
  {
    "_id": "...",
    "userId": "...",
    "type": "food",
    "date": "2026-01-29",
    "time": "12:30",
    "data": { "meal": "午餐", "notes": "雞胸肉沙拉" },
    "createdAt": "2026-01-29T12:00:00.000Z"
  }
]
```

---

### `getDatesWithLogs()`
取得有日誌的日期清單（用於日曆高亮）。

**Response**
```json
["2026-01-29", "2026-01-28"]
```

---

## Members Actions

### `getMembers()`
取得所有會員列表（僅 Admin 可用）。

**Response**
```json
[
  {
    "_id": "...",
    "username": "alex_1700000000000",
    "name": "Alex Chen",
    "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=Alex",
    "role": "Member",
    "status": "Active",
    "createdAt": "2026-01-29T12:00:00.000Z",
    "updatedAt": "2026-01-29T12:00:00.000Z"
  }
]
```

---

### `createMember(input)`
新增會員（僅 Admin 可用）。

**Input**
```json
{
  "name": "Alex Chen",
  "status": "Active",
  "role": "Member"
}
```

**注意**
- `username` 由後端自動產生。
- 新增的會員尚未設定密碼，無法登入（需另行提供註冊/重設流程）。

---

### `updateMember(memberId, input)`
更新會員資料（僅 Admin 可用）。

**Input**
```json
{
  "name": "Sam Lin",
  "status": "Suspended",
  "role": "Coach"
}
```

---

### `deleteMember(memberId)`
刪除會員（僅 Admin 可用）。

---

## 錯誤回應格式

所有錯誤回應遵循以下格式：

```json
{
  "error": "錯誤訊息",
  "code": "UNAUTHORIZED | FORBIDDEN | NOT_FOUND | VALIDATION_ERROR"
}
```
