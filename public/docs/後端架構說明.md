# Backend Architecture (Mixed Mode)

HealthFun uses a mixed backend approach:
- **Server Actions** for internal UI forms
- **REST API Routes** for trend queries and external-style endpoints

---

## Server Actions

Location: `web/src/actions/`

- `dashboard.ts`: water settings, water entries, daily tasks
- `logs.ts`: create logs, query logs by date, list log dates
- `members.ts`: admin-only member management

Server Actions are called directly from React components using the `action={}` or `await` pattern.

---

## REST API Routes

Location: `web/src/app/api/`

- `auth/[...nextauth]`: authentication endpoints
- `trends/weight`: weight trend aggregation
- `trends/activity`: activity distribution aggregation
- `trends/hydration`: hydration aggregation

These endpoints are consumed via `fetch()` and return JSON.

---

## Database Layer

Location: `web/src/lib/db/`

- `connect.ts`: MongoDB connection (singleton)
- `models/`: Mongoose models
- `seed.ts`: admin auto-seed

---

## Auth Layer

Location: `web/src/lib/auth.ts`

- NextAuth configuration with credentials provider
- Session and JWT callbacks expose `user.id` and `user.role`

---

## Timezone

All date logic uses `Asia/Taipei` for normalization and reporting.
